package ru.ifmo.ctd.ngp.demo.util.stats

import org.junit.{Assert, Test}

/**
 * Test if `Wilcoxon` works.
 */
class WilcoxonTests {
  //R reports only four significant digits
  def assertRelative(expected: Double, found: Double): Unit = {
    Assert.assertEquals("%.4g".format(expected), "%.4g".format(found))
  }

  @Test
  def someKnownPValues1(): Unit = {
    assertRelative(0.1544,  Wilcoxon.rankSumTest(
      Seq(1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7),
      Seq(1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9)
    ))
  }

  @Test
  def someKnownPValues2(): Unit = {
    assertRelative(0.08298, Wilcoxon.rankSumTest(
      Seq(1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7),
      Seq(1.21, 1.31, 1.41, 1.51, 1.61, 1.71, 1.81, 1.91)
    ))
  }

  @Test
  def someKnownPValues3(): Unit = {
    assertRelative(0.7381, Wilcoxon.rankSumTest(
      Seq(
        0.5540115516275853,1.026744923307723,1.3175524492311155,1.1373943552100136,1.1551329920013473,
        1.0704922494259315,1.422520773826581,0.8982483852754983,0.5501551300019254,0.6236773968710949,
        1.4576805041901655,0.5818031110062589,1.1056598045236035,0.644433774576925,0.5316426084401801,
        0.9495704177508607,0.5032133542034138,1.1007131039255724,1.4168483716640807,1.165991326071759,
        1.1973154026730946,1.341427266374121,1.0800228482760228,1.3941246991224596,1.3633656601399804,
        1.3652693750347673,0.5280398010442917,0.9631639473711117,0.7669533785890394,1.4148571342075495,
        0.6373194618420608,0.651146860293531,0.6234700363780076,0.7818489077294574,1.225700953891185,
        1.1623574003115515,1.3109905748500779,0.5729410678212469,0.8728011616570972,1.3213000445937633,
        0.7495640615694655,1.4571627699764145,0.8981925041132225,0.8537608253588786,1.3665001327258994,
        1.0916423245257219,1.4663019250060412,0.8803519019170307,0.8299326135267969,1.0060271114708013
      ), Seq(
        1.4085084624339044,1.1513265094844316,1.214435931536348,0.978392756334819,1.1802134183001887,
        1.3367136273335443,0.7232546830716723,0.6494526200465409,1.1945876994673559,1.4861167897457417,
        1.393073089778944,0.5151650619109013,1.123983786259137,1.1479352756701977,1.340685229067061,
        1.11450496223291,0.6087362179195901,0.7593920389416916,1.161717965408859,1.2612494751467744,
        1.1198752422894627,1.2161092302477883,0.7867285231451077,0.981605614387474,0.6738197830629119,
        0.9663999509842267,0.7064474417466179,1.224311013091533,1.188508944354946,0.5391205132566852,
        0.6354114272996331,0.8794934508309542,0.6815640149753024,1.0828723519368255,1.4224880551293535,
        0.764644842072177,0.8284557785183451,1.3195381283365455,1.1623025433809275,1.0143856828711826,
        0.6222849546467193,1.296582212505807,1.0133342818099889,0.745266397261802,1.0066661361178828,
        1.4602405147991457,1.1864588200014743,0.9576719260135124,1.3893385988515359,0.8656704794438213
      )
    ))
  }

  @Test
  def someKnownPValues4(): Unit = {
    assertRelative(1.083e-05, Wilcoxon.rankSumTest(
      Seq(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9),
      Seq(10000.0, 10000.1, 10000.2, 10000.3, 10000.4, 10000.5, 10000.6, 10000.7, 10000.8, 10000.9)
    ))
  }
}
